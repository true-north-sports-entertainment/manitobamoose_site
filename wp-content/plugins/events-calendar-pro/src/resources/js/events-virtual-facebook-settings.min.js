/**
 * This JS file was auto-generated via Terser.
 *
 * Contributors should avoid editing this file, but instead edit the associated
 * non minified file file. For more information, check out our engineering docs
 * on how we handle JS minification in our engineering docs.
 *
 * @see: https://evnt.is/dev-docs-minification
 */

tribe.events=tribe.events||{},tribe.events.facebookSettingsAdmin=tribe.events.facebookSettingsAdmin||{},function($,obj){const $document=$(document);obj.GraphVersion="v9.0",obj.selectors={messageWrap:".tec-events-virtual-settings-message__wrap",facebookContainer:".tribe-settings-facebook-integration",facebookSaveApp:".tribe-settings-facebook-application__connect-container",facebookSaveAppBtn:".tribe-settings-facebook-application__connect-button",facebookPages:".tribe-settings-facebook-application-pages__container",facebookPageList:".tribe-settings-facebook-page-list",facebookAddPage:".tribe-events-virtual-meetings-facebook-settings__add-page-button",facebookPageContainer:".tribe-settings-facebook-page-details__container",facebookAppMessageContainer:".tec-facebook-app-messages",facebookPageMessageContainer:".tec-facebook-page-messages",facebookPageName:".tribe-settings-facebook-page-details__page-name-input",facebookPageId:".tribe-settings-facebook-page-details__page-id-input",facebookAccessToken:".tribe-settings-facebook-page-details__page-access-token-input",facebookClearAccess:".tribe-settings-facebook-page-details__clear-access",facebookDeletePage:".tribe-settings-facebook-page-details__delete-page",facebookSavePage:".tribe-settings-facebook-page-details__save-page",facebookAppId:'input[name="tribe_facebook_app_id"]',facebookAppSecret:'input[name="tribe_facebook_app_secret"]',autoDetectPreviewClass:".tec-virtual-video-embed__facebook"},obj.onAppSaveSuccess=function(html){const $message=$(html).filter(obj.selectors.messageWrap),$facebookPages=$(html).filter(obj.selectors.facebookPages);$(obj.selectors.facebookAppMessageContainer).html($message),0!==$facebookPages.length&&$(obj.selectors.facebookSaveApp).replaceWith($facebookPages)},obj.handleSaveApp=function(event){event.preventDefault();const url=$(this).data("ajaxSaveUrl"),facebookAppId=$(obj.selectors.facebookAppId).val(),facebookAppSecret=$(obj.selectors.facebookAppSecret).val();$.ajax(url,{contentType:"application/json",context:$(this).closest(obj.selectors.facebookContainer),data:{facebook_app_id:facebookAppId,facebook_app_secret:facebookAppSecret},success:obj.onAppSaveSuccess})},obj.handleEnableSave=function(){const $page=$(this).closest(obj.selectors.facebookPageContainer),pageName=$page.find(obj.selectors.facebookPageName).val(),pageId=$page.find(obj.selectors.facebookPageId).val(),$pageSave=$page.find(obj.selectors.facebookSavePage);$pageSave.prop("disabled",!0),pageName&&pageId&&$pageSave.prop("disabled",!1)},obj.onPageSaveSuccess=function(html){const $message=$(html).filter(obj.selectors.messageWrap),$facebookPage=$(html).filter(obj.selectors.facebookPageContainer);if($(obj.selectors.facebookPageMessageContainer).html($message),0===$facebookPage.length)return;const localId=$facebookPage.data("localId");$document.find(`[data-local-id='${localId}']`).replaceWith($facebookPage),FB.XFBML.parse()},obj.handleSavePage=function(event){event.preventDefault();const $this=$(this),url=$this.data("ajaxSaveUrl"),$page=$this.closest(obj.selectors.facebookPageContainer),localId=$page.data("localId"),pageName=$page.find(obj.selectors.facebookPageName).val(),pageId=$page.find(obj.selectors.facebookPageId).val(),accessToken=$page.find(obj.selectors.facebookAccessToken).val();$.ajax(url,{contentType:"application/json",context:$(this).closest(obj.selectors.facebookPageContainer),data:{local_id:localId,page_name:pageName,page_id:pageId,access_token:accessToken},success:obj.onPageSaveSuccess})},obj.handleClearAccess=function(event){event.preventDefault();const $this=$(this),url=$this.attr("href"),$facebookPage=$this.closest(obj.selectors.facebookPageContainer),localId=$facebookPage.data("localId");confirm(tribe_events_virtual_facebook_settings_strings.pageClearAccessConfirmation)&&$.ajax(url,{contentType:"application/json",context:$facebookPage,data:{local_id:localId},success:obj.onPageSaveSuccess})},obj.onPageDeleteSuccess=function(html){$(obj.selectors.facebookPageMessageContainer).html(html),$(`${obj.selectors.facebookPageContainer}.to-delete`).remove()},obj.handleDeletePage=function(event){event.preventDefault();const $this=$(this),url=$this.data("ajaxDeleteUrl"),$facebookPage=$this.closest(obj.selectors.facebookPageContainer),localId=$facebookPage.data("localId");confirm(tribe_events_virtual_facebook_settings_strings.pageDeleteConfirmation)&&($facebookPage.addClass("to-delete"),$.ajax(url,{contentType:"application/json",context:$(this).closest(obj.selectors.facebookPageContainer),data:{local_id:localId},success:obj.onPageDeleteSuccess}))},obj.facebookInit=function(){if("undefined"==typeof FB)return!1;let facebookAppId=$(obj.selectors.facebookAppId).val();(!facebookAppId||facebookAppId<1)&&(facebookAppId=tribe_events_virtual_facebook_settings_strings.facebookAppId),!facebookAppId||facebookAppId<1||FB.init({appId:facebookAppId,autoLogAppEvents:!0,xfbml:!0,version:obj.GraphVersion})},obj.displayMessage=function(message,messageClass="updated"){const messageWrap=`\n\t\t\t<div\n\t\t\t\tid="tribe-events-virtual-settings-message"\n\t\t\t\tclass="tec-events-virtual-settings-message__wrap ${messageClass}"\n\t\t\t>\n\t\t\t\t${message}\n\t\t\t</div>\n\t\t`;$(obj.selectors.facebookPageMessageContainer).html(messageWrap)},obj.handleSavePageAccess=function(localId,$facebookPage,pageId,accessToken){const url=$facebookPage.data("ajaxSaveAccessUrl");$.ajax(url,{contentType:"application/json",context:$facebookPage,data:{local_id:localId,page_id:pageId,access_token:accessToken},success:obj.onPageSaveSuccess})},obj.getPageAccessToken=function(pageId,accessToken,$facebookPage){$.ajax({url:`https://graph.facebook.com/${pageId}?fields=access_token&access_token=${accessToken}`,type:"GET",dataType:"json",success:function(result){if(void 0!==result.access_token)$facebookPage.find(obj.selectors.facebookAccessToken).val(result.access_token),obj.handleSavePageAccess($facebookPage.data("localId"),$facebookPage,pageId,result.access_token);else{const errorMessage=tribe_events_virtual_facebook_settings_strings.pageTokenFailure,error="no page access token";obj.displayMessage(`${errorMessage}: ${error}`,"error")}},error:function(xhr,ajaxOptions,error){const errorMessage=tribe_events_virtual_facebook_settings_strings.pageTokenFailure;obj.displayMessage(`${errorMessage}: ${error}`,"error")}})},obj.getExtendedAccessToken=function(appId,appSecret,userAccessToken,pageId,$facebookPage){if(appId&&appSecret&&userAccessToken&&pageId&&$facebookPage)$.ajax({url:`https://graph.facebook.com/oauth/access_token?grant_type=fb_exchange_token&client_id=${appId}&client_secret=${appSecret}&fb_exchange_token=${userAccessToken}`,type:"GET",dataType:"json",success:function(result){if(void 0!==result.access_token)obj.getPageAccessToken(pageId,result.access_token,$facebookPage);else{const errorMessage=tribe_events_virtual_facebook_settings_strings.userTokenFailure,error="no user access token";obj.displayMessage(`${errorMessage}: ${error}`,"error")}},error:function(xhr,ajaxOptions,error){const errorMessage=tribe_events_virtual_facebook_settings_strings.userTokenFailure;obj.displayMessage(`${errorMessage}: ${error}`,"error")}});else{const errorMessage=tribe_events_virtual_facebook_settings_strings.userTokenFailure,error="missing parameter";obj.displayMessage(`${errorMessage}: ${error}`,"error")}},obj.facebookAuthorization=function(localId){if(localId.length<1)return void obj.displayMessage(tribe_events_virtual_facebook_settings_strings.localIdFailure,"error");const $facebookPage=$(obj.selectors.facebookContainer).find(`[data-local-id='${localId}']`);void 0!==$facebookPage?FB.getLoginStatus((function(response){if("connected"!==response.status)return void obj.displayMessage(tribe_events_virtual_facebook_settings_strings.connectionFailure,"error");const userAccessToken=response.authResponse.accessToken,facebookAppId=$(obj.selectors.facebookAppId).val(),facebookAppSecret=$(obj.selectors.facebookAppSecret).val(),pageId=$facebookPage.find(obj.selectors.facebookPageId).val();obj.getExtendedAccessToken(facebookAppId,facebookAppSecret,userAccessToken,pageId,$facebookPage)})):obj.displayMessage(tribe_events_virtual_facebook_settings_strings.pageWrapFailure,"error")},obj.onAddPageSuccess=function(html){const message=$(html).filter(obj.selectors.messageWrap),pageWrap=$(html).filter(obj.selectors.facebookPageContainer);$(obj.selectors.facebookPageMessageContainer).html(message),0!==pageWrap.length&&$(obj.selectors.facebookPageList).append(pageWrap)},obj.handleAddPage=function(event){event.preventDefault();const url=$(this).attr("href");$.ajax(url,{contentType:"application/json",context:$(obj.selectors.facebookPageList),success:obj.onAddPageSuccess})},obj.handleAutoDetectFacebookVideo=function(event,data){if(!data.html)return;0!==$(data.html).filter(obj.selectors.autoDetectPreviewClass).length&&obj.facebookInit()},obj.bindEvents=function(){$document.on("change",`${obj.selectors.facebookPageName}, ${obj.selectors.facebookPageId}`,obj.handleEnableSave).on("click",obj.selectors.facebookSaveAppBtn,obj.handleSaveApp).on("click",obj.selectors.facebookSavePage,obj.handleSavePage).on("click",obj.selectors.facebookClearAccess,obj.handleClearAccess).on("click",obj.selectors.facebookDeletePage,obj.handleDeletePage),$(obj.selectors.facebookContainer).on("click",obj.selectors.facebookAddPage,obj.handleAddPage),$document.on("autodetect.videoPreview",obj.handleAutoDetectFacebookVideo)},obj.ready=function(){obj.bindEvents(),window.facebookAsyncInit=obj.facebookInit()},$(obj.ready)}(jQuery,tribe.events.facebookSettingsAdmin);